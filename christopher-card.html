<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2d3436">
    <meta name="format-detection" content="telephone=no">
    <title>For Jo Katherine</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <!-- CSS Files for cards (loaded but hidden initially) -->
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/rainbow-holo.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
            height: -webkit-fill-available;
            overscroll-behavior: none;
        }

        body {
            font-family: 'Playfair Display', Georgia, serif;
            overflow: hidden;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            touch-action: manipulation;
            min-height: 100%;
            min-height: -webkit-fill-available;
            overscroll-behavior: none;
        }

        /* Intro Screen */
        .intro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #2d3436;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .greeting {
            font-size: clamp(2rem, 8vw, 4.5rem);
            color: #ffeaa7;
            text-align: center;
            padding: 0 20px;
            font-weight: 400;
            letter-spacing: 0.02em;
            font-style: italic;
        }

        .greeting .cursor {
            display: inline-block;
            width: 3px;
            height: 1em;
            background: #ffeaa7;
            margin-left: 4px;
            animation: blink 1s infinite;
            vertical-align: text-bottom;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .tap-continue {
            position: absolute;
            bottom: 60px;
            bottom: calc(60px + env(safe-area-inset-bottom));
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 0.95rem;
            font-weight: 400;
            color: rgba(255, 234, 167, 0.6);
            font-style: normal;
            opacity: 0;
            transition: opacity 0.5s ease;
            letter-spacing: 0.01em;
        }

        .tap-continue.visible {
            opacity: 1;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* User Agreement Screen */
        .agreement {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #2d3436;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            padding: 20px;
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
            padding-left: max(20px, env(safe-area-inset-left));
            padding-right: max(20px, env(safe-area-inset-right));
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .agreement.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .agreement-container {
            max-width: 500px;
            width: 100%;
            margin: auto;
        }

        .agreement-title {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            color: rgba(255, 234, 167, 0.9);
            margin-bottom: 20px;
            text-align: left;
            line-height: 1.5;
        }

        .agreement-text {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 0.85rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
            line-height: 1.7;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid rgba(255, 234, 167, 0.5);
        }

        .agreement-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            cursor: pointer;
            padding: 10px 0;
            -webkit-tap-highlight-color: transparent;
        }

        .agreement-checkbox input {
            width: 24px;
            height: 24px;
            min-width: 24px;
            accent-color: #ffeaa7;
            cursor: pointer;
        }

        .agreement-checkbox label {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            line-height: 1.4;
        }

        .agreement-btn {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1rem;
            font-weight: 500;
            padding: 16px 40px;
            border: none;
            border-radius: 8px;
            cursor: not-allowed;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.3);
            transition: all 0.2s ease;
            width: 100%;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .agreement-btn.active {
            cursor: pointer;
            background: #ffeaa7;
            color: #2d3436;
        }

        .agreement-btn.active:hover,
        .agreement-btn.active:active {
            background: #fff3b0;
        }

        .agreement-btn.active:active {
            transform: scale(0.98);
        }

        /* Main content (hidden initially) */
        main {
            background: #2d3436;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            perspective: 1000px;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        main.visible {
            opacity: 1;
        }

        .cards-wrapper {
            display: flex;
            gap: 40px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            padding: 20px;
        }

        .card-container {
            width: 330px;
            height: 459px;
        }

        /* Second card without illusion mask */
        #card-2 .card .card__shine:before {
            display: none;
        }

        /* Third card uses cosmos texture instead of glitter */
        #card-3 .card {
            --glitter: url("/img/cosmos-bottom.webp");
            --glittersize: 100%;
        }
        #card-3 .card .card__shine:before {
            display: none;
        }

        /* Mobile Navigation Zones (hidden on desktop) */
        .nav-zone {
            display: none;
        }

        /* Card dots indicator (hidden on desktop) */
        .card-dots {
            display: none;
        }

        /* Mobile optimization */
        @media (max-width: 768px) {
            .intro {
                padding: 20px;
                padding-bottom: calc(20px + env(safe-area-inset-bottom));
            }

            .greeting {
                font-size: clamp(1.8rem, 7vw, 3rem);
                line-height: 1.4;
            }

            .tap-continue {
                bottom: calc(40px + env(safe-area-inset-bottom));
                font-size: 0.85rem;
            }

            /* Agreement mobile tweaks */
            .agreement {
                justify-content: flex-start;
                padding-top: calc(40px + env(safe-area-inset-top));
            }

            .agreement-container {
                margin-top: 0;
            }

            .agreement-text {
                font-size: 0.8rem;
                padding: 15px;
                margin-bottom: 20px;
            }

            .agreement-checkbox label {
                font-size: 0.8rem;
            }

            main {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                padding: 0 !important;
                margin: 0 !important;
                overflow: hidden !important;
                display: block !important;
            }

            .cards-wrapper {
                display: flex !important;
                flex-direction: row !important;
                flex-wrap: nowrap !important;
                justify-content: flex-start !important; /* Key fix: align to start, not center */
                align-items: center !important;
                gap: 0 !important;
                padding: 0 !important;
                margin: 0 !important;
                width: 300vw !important; /* 3 cards */
                height: 100vh !important;
                position: relative !important;
                left: 0 !important;
                transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            }

            .cards-wrapper[data-active="0"] {
                transform: translateX(0) !important;
            }

            .cards-wrapper[data-active="1"] {
                transform: translateX(-100vw) !important;
            }

            .cards-wrapper[data-active="2"] {
                transform: translateX(-200vw) !important;
            }

            .card-container {
                flex: 0 0 100vw !important; /* Don't grow, don't shrink, exactly 100vw */
                width: 100vw !important;
                min-width: 100vw !important;
                max-width: 100vw !important;
                height: 100vh !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
                padding: 0 !important;
                margin: 0 !important;
                box-sizing: border-box !important;
            }

            /* Make card larger on mobile */
            .card-container .card {
                transform-origin: center center;
            }

            .card-container .card,
            .card-container .card .card__translater,
            .card-container .card .card__rotator {
                width: 80vw !important;
                max-width: 360px !important;
                height: auto !important;
                aspect-ratio: 0.718;
            }

            .card-container .card .card__rotator img,
            .card-container .card .card__front,
            .card-container .card .card__back {
                width: 100% !important;
                height: 100% !important;
            }

            /* Navigation zones */
            .nav-zone {
                display: block;
                position: fixed;
                top: 0;
                height: 100%;
                width: 20%;
                z-index: 100;
                -webkit-tap-highlight-color: transparent;
            }

            .nav-zone--left {
                left: 0;
            }

            .nav-zone--right {
                right: 0;
            }

            /* Card dots indicator */
            .card-dots {
                display: flex;
                position: fixed;
                bottom: 40px;
                bottom: calc(40px + env(safe-area-inset-bottom));
                left: 50%;
                transform: translateX(-50%);
                gap: 12px;
                z-index: 100;
            }

            .card-dot {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: rgba(255, 234, 167, 0.3);
                transition: all 0.3s ease;
                cursor: pointer;
                -webkit-tap-highlight-color: transparent;
                position: relative;
            }

            /* Larger invisible touch target */
            .card-dot::before {
                content: '';
                position: absolute;
                top: -15px;
                left: -15px;
                right: -15px;
                bottom: -15px;
            }

            .card-dot.active {
                background: rgba(255, 234, 167, 0.9);
                transform: scale(1.3);
            }
        }

        /* Small phones */
        @media (max-width: 380px) {
            .greeting {
                font-size: 1.6rem;
            }

            .tap-continue {
                bottom: 30px;
                font-size: 0.8rem;
            }
        }

        /* Ensure touch targets are large enough */
        @media (pointer: coarse) {
            .intro, .nav-zone {
                -webkit-tap-highlight-color: transparent;
            }
        }
    </style>
</head>
<body>
    <!-- Intro Screen -->
    <div class="intro" id="intro">
        <h1 class="greeting">
            <span id="typed-text"></span><span class="cursor" id="cursor"></span>
        </h1>
        <p class="tap-continue" id="tap-continue">tap anywhere to continue</p>
    </div>

    <!-- User Agreement Screen -->
    <div class="agreement" id="agreement">
        <div class="agreement-container">
            <p class="agreement-title">Please read the following user agreement and select accept to continue:</p>
            <p class="agreement-text">"The developer would like to emphasize that any and all images showing the likeness of Jo Katherine or any abilities, and health stats are in no way a reflection of Joanna's true nature. It is impossible to properly capture the beauty and essence of such a lovely lady. Please forward any questions comments or concerns in the form of a handwritten letter to Christopher Giroux :)"</p>
            <div class="agreement-checkbox">
                <input type="checkbox" id="agree-checkbox">
                <label for="agree-checkbox">I have read and accept the user agreement</label>
            </div>
            <button class="agreement-btn" id="agree-btn" disabled>Continue</button>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content">
        <div class="cards-wrapper" id="cards-wrapper" data-active="0">
            <div id="card-1" class="card-container"></div>
            <div id="card-2" class="card-container"></div>
            <div id="card-3" class="card-container"></div>
        </div>

        <!-- Mobile navigation zones -->
        <div class="nav-zone nav-zone--left" id="nav-left"></div>
        <div class="nav-zone nav-zone--right" id="nav-right"></div>

        <!-- Card indicator dots -->
        <div class="card-dots" id="card-dots">
            <div class="card-dot active" data-index="0"></div>
            <div class="card-dot" data-index="1"></div>
            <div class="card-dot" data-index="2"></div>
        </div>
    </main>

    <script type="module">
        import { PokemonCard } from './js/components/PokemonCard.js';

        // Intro messages sequence
        const messages = [
            "Hello miss Jo Katherine",
            "fancy seeing you here",
            "merry christmas and happy birthday!",
            "also, im literally courting you  - Chris G"
        ];

        const typedTextEl = document.getElementById('typed-text');
        const cursorEl = document.getElementById('cursor');
        const tapContinueEl = document.getElementById('tap-continue');
        const introEl = document.getElementById('intro');
        const agreementEl = document.getElementById('agreement');
        const agreeCheckbox = document.getElementById('agree-checkbox');
        const agreeBtn = document.getElementById('agree-btn');
        const mainEl = document.getElementById('main-content');

        let currentMessage = 0;
        let charIndex = 0;
        let typingComplete = false;
        let lastTime = 0;
        const baseSpeed = 75; // ms per character

        // Smoother typing animation using requestAnimationFrame
        function typeNextChar(timestamp) {
            if (!lastTime) lastTime = timestamp;
            const elapsed = timestamp - lastTime;
            const message = messages[currentMessage];

            if (elapsed >= baseSpeed) {
                if (charIndex < message.length) {
                    typedTextEl.textContent += message[charIndex];
                    charIndex++;
                    lastTime = timestamp;

                    // Add slight pause after punctuation or spaces
                    if (message[charIndex - 1] === ' ') {
                        lastTime -= 20; // Slightly faster after spaces
                    }
                } else {
                    // Typing complete
                    typingComplete = true;
                    cursorEl.style.display = 'none';
                    tapContinueEl.classList.add('visible');
                    return;
                }
            }

            requestAnimationFrame(typeNextChar);
        }

        // Start typing the first message
        function startTyping() {
            charIndex = 0;
            lastTime = 0;
            typingComplete = false;
            typedTextEl.textContent = '';
            cursorEl.style.display = 'inline-block';
            tapContinueEl.classList.remove('visible');
            setTimeout(() => requestAnimationFrame(typeNextChar), 400);
        }

        // Initial start
        setTimeout(startTyping, 800);

        // Handle tap/click to continue
        introEl.addEventListener('click', () => {
            if (!typingComplete) return;

            currentMessage++;

            // If there are more messages, show the next one
            if (currentMessage < messages.length) {
                startTyping();
                return;
            }

            // All messages shown, fade to agreement screen
            introEl.style.opacity = '0';
            introEl.style.transition = 'opacity 0.8s ease';

            setTimeout(() => {
                introEl.style.display = 'none';
                agreementEl.classList.add('visible');
            }, 800);
        });

        // Agreement checkbox handler
        agreeCheckbox.addEventListener('change', () => {
            if (agreeCheckbox.checked) {
                agreeBtn.classList.add('active');
                agreeBtn.disabled = false;
            } else {
                agreeBtn.classList.remove('active');
                agreeBtn.disabled = true;
            }
        });

        // Agreement button handler - show cards
        agreeBtn.addEventListener('click', () => {
            if (!agreeCheckbox.checked) return;

            agreementEl.classList.remove('visible');

            setTimeout(() => {
                mainEl.classList.add('visible');

                // Card 1 - DrJo
                const container1 = document.getElementById('card-1');
                const card1 = new PokemonCard(container1, {
                    id: "custom-001",
                    set: "custom",
                    name: "Jo Katherine",
                    supertype: "Pokémon",
                    subtypes: ["Basic"],
                    types: ["Psychic"],
                    number: "001",
                    rarity: "Rare Rainbow",
                    img: "/assets/cards/DrJo.webp",
                    showcase: true
                });

                // Card 2 - JoSquared
                const container2 = document.getElementById('card-2');
                setTimeout(() => {
                    const card2 = new PokemonCard(container2, {
                        id: "custom-002",
                        set: "custom",
                        name: "Jo Squared",
                        supertype: "Pokémon",
                        subtypes: ["Basic"],
                        types: ["Psychic"],
                        number: "002",
                        rarity: "Rare Rainbow",
                        img: "/assets/cards/JoSquared.webp",
                        showcase: true
                    });
                    window.card2 = card2;
                }, 400);

                // Card 3 - MiniME (with cosmos texture)
                const container3 = document.getElementById('card-3');
                setTimeout(() => {
                    const card3 = new PokemonCard(container3, {
                        id: "custom-003",
                        set: "custom",
                        name: "Mini Me",
                        supertype: "Pokémon",
                        subtypes: ["Basic"],
                        types: ["Psychic"],
                        number: "003",
                        rarity: "Rare Rainbow",
                        img: "/assets/cards/MiniME.webp",
                        showcase: true
                    });
                    window.card3 = card3;
                }, 800);

                window.card1 = card1;

                // Mobile carousel navigation
                setupMobileNav();
            }, 800);
        });

        // Mobile carousel functionality
        function setupMobileNav() {
            const cardsWrapper = document.getElementById('cards-wrapper');
            const navLeft = document.getElementById('nav-left');
            const navRight = document.getElementById('nav-right');
            const dots = document.querySelectorAll('.card-dot');
            const totalCards = 3;
            let currentCard = 0;

            function goToCard(index) {
                if (index < 0 || index >= totalCards) return;
                currentCard = index;
                cardsWrapper.dataset.active = currentCard;

                // Update dots
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === currentCard);
                });
            }

            function nextCard() {
                if (currentCard < totalCards - 1) {
                    goToCard(currentCard + 1);
                }
            }

            function prevCard() {
                if (currentCard > 0) {
                    goToCard(currentCard - 1);
                }
            }

            // Navigation zone clicks
            navLeft.addEventListener('click', prevCard);
            navRight.addEventListener('click', nextCard);

            // Dot clicks
            dots.forEach(dot => {
                dot.addEventListener('click', () => {
                    goToCard(parseInt(dot.dataset.index));
                });
            });

            // Swipe support
            let touchStartX = 0;
            let touchEndX = 0;

            cardsWrapper.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });

            cardsWrapper.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                const swipeDistance = touchStartX - touchEndX;

                if (Math.abs(swipeDistance) > 50) {
                    if (swipeDistance > 0) {
                        nextCard();
                    } else {
                        prevCard();
                    }
                }
            }, { passive: true });
        }
    </script>
</body>
</html>
